<!DOCTYPE html>

<head>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="./socket.io.js"></script>
<script src="./underscore-min.js"></script>
<script src="./jquery.min.js"></script>
<LINK href="./style.css" rel="stylesheet" type="text/css"></style>
</head>
<body>


<svg class="chart"></svg>

<script>
var socket = io();
var data = [];
// drawChart( data );


socket.on('data', function( buttonValue ){
  console.log( buttonValue );

  updateData( buttonValue );
  console.log(data);  
});

function updateData(buttonValue) {
  console.log('updating data');
  // Define the data again
  data.push( buttonValue );
  drawChart( data );

 };      
function drawChart( data ){
  console.log('drawing chart with data: ' + data );
  var data = data;

  var width = 420,
      barHeight = 20;

  var x = d3.scale.linear()
       // .domain([0, d3.max(data)])
      .domain([0, 255])
      .range([0, width]);

  var chart = d3.select(".chart")
      .attr("width", width)
      .attr("height", barHeight * data.length);
  console.log('    chart:');
  console.dir( chart );
  var bar = chart.selectAll("g")
      .data(data)
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });
  console.log('    bar:');
  console.dir();  

  bar.append("rect")
      .attr("width", x)
      .attr("height", barHeight - 1);

  bar.append("text")
      .attr("x", function(d) { return x(d) - 3; })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
      .text(function(d) { return d; });
    };

</script>

</body>
