<!DOCTYPE html>

<head>
<meta charset="utf-8">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="./socket.io.js"></script>
<script src="./underscore-min.js"></script>
<script src="./jquery.min.js"></script>
<LINK href="./style.css" rel="stylesheet" type="text/css"></style>
</head>
<body>

<script>

var socket = io();
var data = [ 3 ];
var counter = 0;
var containerWidth = 478;
var containerHeight = 430;
var cx = containerWidth/2;
var cy = containerHeight/2;
var currentRadius = 0;
var scaleFactor = 20;

var svgContainer = d3.select( 'body' )
  .append( 'svg' )
  .attr( 'width', containerWidth )
  .attr( 'height', containerHeight );

drawCircle( data );

socket.on( 'data', function( buttonValue ){
  console.log( buttonValue );
  // toggleCircle( buttonValue );
  replaceCircle( buttonValue );
});

function updateData( value ) {
  console.log( 'updating data' );
  data.push( value );
}

function removeCircle(){
  var circles = svgContainer.selectAll( 'circle' );
  myCircle = circles[ 0 ][ 0 ];
  console.dir( myCircle );
  var toRemove = d3.select( myCircle );
  console.dir( toRemove );
  toRemove.remove();
  console.log( 'Removing: ' + toRemove );
}
function drawCircle( data ){
  console.log( 'current radius: ' + currentRadius );
  var circles = svgContainer.selectAll( 'circle' )
    .data( data )
    .enter()
    .append( 'circle' )
      .attr( 'cx' , cx )
      .attr( 'cy' , cy )
      .attr( 'r', currentRadius)
    .transition()
    .duration(200)
      .attr( 'r' , function(d){ 
        currentRadius = scaleFactor * d; 
        return scaleFactor * d } );
  console.log('drawing circle');  
}

function toggleCircle( buttonValue ){
  console.log( counter % 2 );
  if( counter % 2 === 0 ){
    drawCircle( [ buttonValue ] );
  } else {
    removeCircle();
  }
  counter++;  
}

function replaceCircle( buttonValue ){
  var promise = new Promise( function( resolve, reject ){
    removeCircle();
    resolve();
  });

  promise.then( drawCircle( [ buttonValue ] ) );;

}
</script>

</body>